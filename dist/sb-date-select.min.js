angular.module("sbDateSelect",[]).directive("sbDateSelect",[function(){return{restrict:"A",replace:!0,template:['<div class="sb-date-select">','<select class="sb-date-select-day sb-date-select-select" ng-class="selectClass" ng-model="val.date", ng-options="d for d in dates track by d">',"<option value disabled selected>Day</option>","</select>",'<select class="sb-date-select-month sb-date-select-select" ng-class="selectClass" ng-model="val.month", ng-options="m.value as m.name for m in months">',"<option value disabled>Month</option>","</select>",'<select class="sb-date-select-year sb-date-select-select" ng-class="selectClass" ng-model="val.year" ng-options="y for y in years">',"<option value disabled selected>Year</option>","</select>","</div>"].join(""),require:"ngModel",scope:{selectClass:"@sbSelectClass"},link:function(e,a,t,l){function s(){e.months=[];for(var a=e.val.year&&o.isSame([e.val.year],"year")?o.month():0,t=e.val.year&&m.isSame([e.val.year],"year")?m.month():11,l=moment.months(),s=a;s<=t;s++)e.months.push({name:l[s],value:s+1});(e.val.month-1>t||e.val.month-1<a)&&delete e.val.month}function n(a,t){var l,s;l=e.val.year&&e.val.month&&o.isSame([e.val.year,e.val.month-1],"month")?o.date():1,s=e.val.year&&e.val.month&&m.isSame([e.val.year,e.val.month-1],"month")?m.date():e.val.year&&e.val.month?moment([e.val.year,e.val.month-1]).daysInMonth():31,e.dates=[];for(var n=l;n<=s;n++)e.dates.push(n);(e.val.date<l||e.val.date>s)&&delete e.val.date}e.val={};var o=e.min=moment(t.min||"1900-01-01"),m=e.max=moment(t.max);e.years=[];for(var v=m.year();v>=o.year();v--)e.years.push(v);e.$watch("val.year",function(){s()}),e.$watchCollection("[val.month, val.year]",function(){n()}),e.$watchCollection("[val.date, val.month, val.year]",function(){if(e.val.year&&e.val.month&&e.val.date){var a=moment([e.val.year,e.val.month-1,e.val.date]);l.$setViewValue(a.format("YYYY-MM-DD"))}else l.$setViewValue()}),l.$render=function(){if(l.$viewValue){var a=moment(l.$viewValue);e.val={year:a.year(),month:a.month()+1,date:a.date()}}}}}}]);